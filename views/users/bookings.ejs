<% layout("layouts/boilerplate.ejs") %>
<div class="container mt-4">
    <h2 class="mb-4 text-center text-primary fw-bold">My Bookings</h2>

    <% if (bookings.length === 0) { %>
        <div class="alert alert-info text-center">You have no bookings yet.</div>
    <% } else { %>
    <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle shadow-sm">
            <thead class="table-dark text-center">
                <tr>
                    <th>Listing</th>
                    <th>Location</th>
                    <th>Check-in</th>
                    <th>Check-out</th>
                    <th>Guests</th>
                    <th>Amount (₹)</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody class="text-center">
                <% bookings.forEach(booking => { %>
                <tr>
                    <td><%= booking.listing ? booking.listing.title : "Removed" %></td>
                    <td><%= booking.listing ? booking.listing.location : "" %></td>
                    <td><%= booking.checkIn.toLocaleDateString() %></td>
                    <td><%= booking.checkOut.toLocaleDateString() %></td>
                    <td><%= booking.guests %></td>
                    <td class="text-success fw-semibold">₹<%= booking.totalAmount %></td>
                    <td>
                        <% 
                            const status = booking.bookingStatus && booking.bookingStatus.trim().toLowerCase(); 
                        %>
                        <% if (status === 'confirmed') { %>
                            <span class="badge bg-success">Confirmed</span>
                        <% } else if (status === 'pending') { %>
                            <span class="badge bg-warning text-dark">Pending</span>
                        <% } else { %>
                            <span class="badge bg-danger">Cancelled</span>
                        <% } %>
                    </td>

                </tr>
                <% }) %>
            </tbody>
        </table>
    </div>
    <% } %>
</div>
